<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div>
    <div>我是get请求结果: <span id="getRes"></span>
    </div>
    <div>我是post请求结果: <span id="postRes"></span>
    </div>
</div>
</body>
<script>
    var util = {};
    //浅拷贝************************************************
    util.extend = function (dst, obj) {
        for (var i in obj) {
//            所有继承了 Object 的对象都会继承到 hasOwnProperty 方法。这个方法可以用来检测一个对象是否含有特定的自身属性；和 in 运算符不同，该方法会忽略掉那些从原型链上继承到的属性。
            if (obj.hasOwnProperty(i)) {
//                注意dst.i这种写法会声名一个i属性，这并不是我们想要的
//                dst.i = obj.i;
                dst[i] = obj[i];
            }
        }
    };

    var Obj = function (a, b) {
        this.a = a;
        this.b = b;
    };

    Obj.prototype.prototypeField = 'i_am_prototypeField';
    var ins1 = new Obj(1, 2);
    var ins2 = {};
    util.extend(ins2, ins1);
    console.log(ins2);//ins2不会继承prototypeField这个属性
    // ************************************************

    util.json = function ajax(options) {
        var opt = {
            url: '',
            type: 'GET',//默认为get请求
            data: {},
            success: function () {
            },
            error: function () {
            }
        };

        util.extend(opt, options);
        //0:请求未初始化
        //1:服务器连接已建立
        //2:请求已接收
        //3:请求处理中 xhr.onprogress监听
        //4:请求已完成，且响应已就绪 xhr.onload监听
        //也可以用request.onreadystatechange监听状态变化
        if (opt.url) {
            var xhr = XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP');
            //0:请求未初始化
            console.log('UNSENT', xhr.status);
            var data = opt.data;
            var type = opt.type;
            var url = opt.url;
            var dataArr = [];
            for (var k in data) {
                dataArr.push(k + '=' + data[k]);
            }

            //HTTP Method是区分大小写的，而Header是不区分的。 所以GET/POST/PUT等需要大写，
            if (type === 'GET') {
                url = url + '?' + dataArr.join('&');
                //  \?表示在url中的问号 \是转义字符,$即结尾
                //1:服务器连接已建立
                //2:请求已接收
                xhr.open(type, url.replace(/\?$/g, ''), true);
                console.log('OPENED:', xhr.status);
                xhr.send();
                console.log('SEND:', xhr.status);

            }

            if (type === 'POST') {

            }

            xhr.onprogress = function () {
                //3:请求处理中
                console.log('LOADING:', xhr.status);
            };
            xhr.onload = function () {
                console.log('DONE:', xhr.status);
                //304：服务器告诉浏览器资源未修改过，可以用缓存
                if(xhr.status === 200 || xhr.status === 304){
                    var res;
                    if(opt.success && opt.success instanceof Function){
                        res = xhr.responseText;
                        if(typeof res === 'string'){
                            res = JSON.parse(res);
                            console.log(res);
                        }
                    }
                }else {
                    if(opt.error && opt.error instanceof Function){
                        console.log('error');
//                        opt.error
                    }
                }
            };
        }
    }
</script>
</html>